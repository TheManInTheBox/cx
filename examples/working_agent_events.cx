// CX Language - Simple Agent Event Demo (Current Working Version)
// Shows how agents interact with events using current grammar


class SimpleAgent
{
    name: string;
    role: string;
    
    constructor(agentName, agentRole)
    {
        this.name = agentName;
        this.role = agentRole;
        print("ğŸ¤– Agent " + this.name + " (" + this.role + ") created");
    }
    
    function handleTask(taskDesc)
    {
        print("ğŸ“‹ " + this.name + " handling: " + taskDesc);
        
        var result = textGen.GenerateAsync(
            "As " + this.name + " (" + this.role + "), handle: " + taskDesc,
            { temperature: 0.7, maxTokens: 100 }
        );
        
        print("âœ… " + this.name + " result: " + result);
        return result;
    }
}

// Global variables for agents
var developer = new SimpleAgent("Alice", "developer");
var designer = new SimpleAgent("Bob", "designer");

// âœ… CURRENT WORKING APPROACH: Global event handlers that call agent methods
on task.request (payload)
{
    print("ğŸ“¨ SYSTEM: Task request received");
    print("   Description: " + payload.description);
    print("   Target: " + payload.targetRole);
    
    if (payload.targetRole == "developer")
    {
        developer.handleTask(payload.description);
    }
    else if (payload.targetRole == "designer")
    {
        designer.handleTask(payload.description);
    }
    else
    {
        print("âŒ No agent found for role: " + payload.targetRole);
    }
}

on agent.status (payload)
{
    print("ğŸ“Š SYSTEM: Status check requested");
    print("   Developer: " + developer.name + " (active)");
    print("   Designer: " + designer.name + " (active)");
}

print("ğŸš€ AGENT EVENT SYSTEM DEMO");
print("===========================");
print("");

print("ğŸ“¤ Emitting development task...");
emit task.request, {
    description: "Fix login bug",
    targetRole: "developer",
    priority: "high"
};

print("");
print("ğŸ“¤ Emitting design task...");
emit task.request, {
    description: "Create wireframes for dashboard",
    targetRole: "designer",
    priority: "medium"
};

print("");
print("ğŸ“¤ Requesting agent status...");
emit agent.status, {
    requestedBy: "admin"
};

print("");
print("âœ… DEMONSTRATION COMPLETE!");
print("");
print("ğŸ¯ CURRENT ARCHITECTURE:");
print("   â€¢ Agents are classes with methods");
print("   â€¢ Global event handlers route to agent methods");
print("   â€¢ Events trigger specific agent behaviors");
print("");
print("ğŸ”® FUTURE GOAL: Class-based event handlers");
print("   â€¢ Event handlers INSIDE agent classes");
print("   â€¢ Direct event â†’ agent response (no routing layer)");
