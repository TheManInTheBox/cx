// âœ… Phase 8: Azure OpenAI Realtime API - Correct CX Object Literal Syntax
// Using proper CX Language object literal format for emit statements



class AzureRealtimeAgent
{

  uses textGen from Cx.AI.TextGeneration;
uses tts from Cx.AI.TextToSpeech;

    name: string;
    isConnected: boolean;
    conversationState: string;
    
    constructor(config)
    {
        this.name = config.name;
        this.isConnected = false;
        this.conversationState = "idle";
        
        print("âœ… " + this.name + " initialized for real-time conversation");
    }
    
    function connect()
    {
        this.isConnected = true;
        this.conversationState = "connected";
        
        // âœ… CORRECT: CX object literals use {property, property} format without colons
        var sessionData = "session-" + this.name;
        var statusInfo = "connected";
        
        emit realtime.session.started, {
            sessionId: sessionData,
            agent: this.name,
            status: statusInfo
        };
        
        print("ğŸ”— " + this.name + " connected to Azure OpenAI Realtime API");
    }
    
    function sendMessage(userInput)
    {
        if (!this.isConnected)
        {
            print("âŒ Agent not connected. Call connect() first.");
            return;
        }
        
        var messageId = "msg-" + userInput;
        var currentAgent = this.name;
        var messageContent = userInput;
        
        emit realtime.message.sent, {
            messageId: messageId,
            agent: currentAgent,
            content: messageContent
        };
        
        print("ğŸ“¤ " + this.name + " sent: " + userInput);
        
        // Simulate AI response
        this.handleResponse("AI response to: " + userInput);
    }
    
    function handleResponse(response)
    {
        var responseId = "resp-" + this.name;
        var currentAgent = this.name;
        var responseContent = response;
        
        emit realtime.response.received, {
            responseId: responseId,
            agent: currentAgent,
            content: responseContent
        };
        
        // Convert to speech
        if (tts)
        {
            tts.SpeakAsync(response);
        }
        
        print("ğŸ“¥ " + this.name + " received: " + response);
    }
    
    function disconnect()
    {
        this.isConnected = false;
        this.conversationState = "disconnected";
        
        var sessionData = "session-" + this.name;
        var statusInfo = "disconnected";
        
        emit realtime.session.closed, {
            sessionId: sessionData,
            agent: this.name,
            status: statusInfo
        };
        
        print("ğŸ”Œ " + this.name + " disconnected from Azure OpenAI Realtime API");
    }
}

class RealtimeResponseAgent
{
    name: string;
    
    constructor(config)
    {
        this.name = config.name;
        print("ğŸ§ " + this.name + " listening for real-time events");
    }
    
    on realtime.session.started (payload)
    {
        print("ğŸš€ Session started - Agent: " + payload.agent + ", ID: " + payload.sessionId);
        
        var eventType = "session_started";
        var agentName = payload.agent;
        
        emit realtime.event.logged, {
            eventType: eventType,
            agent: agentName,
            timestamp: "now"
        };
    }
    
    on realtime.message.sent (payload)
    {
        print("ğŸ“¡ Message sent - Agent: " + payload.agent + ", Content: " + payload.content);
        
        var eventType = "message_sent";
        var agentName = payload.agent;
        
        emit realtime.event.logged, {
            eventType: eventType,
            agent: agentName,
            timestamp: "now"
        };
    }
    
    on realtime.response.received (payload)
    {
        print("ğŸ¤ Response received - Agent: " + payload.agent + ", Content: " + payload.content);
        
        var eventType = "response_received";
        var agentName = payload.agent;
        
        emit realtime.event.logged, {
            eventType: eventType,
            agent: agentName,
            timestamp: "now"
        };
    }
    
    on realtime.session.closed (payload)
    {
        print("ğŸ”’ Session closed - Agent: " + payload.agent + ", ID: " + payload.sessionId);
        
        var eventType = "session_closed";
        var agentName = payload.agent;
        
        emit realtime.event.logged, {
            eventType: eventType,
            agent: agentName,
            timestamp: "now"
        };
    }
    
    on realtime.event.logged (payload)
    {
        print("ğŸ“Š Event logged: " + payload.eventType + " for agent " + payload.agent);
    }
}

print("ğŸ¯ Phase 8: Azure OpenAI Realtime API Demo");
print("==========================================");
print("âœ… Using correct CX Language object literal syntax");
print("");

try
{
    // Create agents
    var realtimeAgent = agent AzureRealtimeAgent({ name: "RealtimeBot" });
    var responseAgent = agent RealtimeResponseAgent({ name: "ResponseMonitor" });
    
    print("ğŸ¤– Agents created successfully");
    print("");
    
    // Demonstrate real-time conversation flow
    print("ğŸ”¥ Starting Real-Time Conversation:");
    print("===================================");
    
    // Connect to real-time API
    realtimeAgent.connect();
    
    // Send messages
    realtimeAgent.sendMessage("Hello, how are you today?");
    realtimeAgent.sendMessage("Can you help me with programming?");
    realtimeAgent.sendMessage("What's the weather like?");
    
    // Disconnect
    realtimeAgent.disconnect();
    
    print("");
    print("âœ… Phase 8 Demo Complete!");
    print("âœ… Real-time conversation flow working");
    print("âœ… Event-driven architecture operational");
    print("âœ… Object literal syntax corrected");
    
}
catch (error)
{
    print("âŒ Error: " + error);
}
