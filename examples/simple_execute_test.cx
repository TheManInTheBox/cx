// Simple Execute Test with Event Handlers - CX Language
// Tests fire-and-forget PowerShell execution with event-driven results

class TestAgent 
{
    name: string;
    
    constructor(agentName)
    {
        this.name = agentName;
        print("ğŸ§ª Created test agent: " + this.name);
    }
    
    function runQuickTests()
    {
        print("ï¿½ " + this.name + " running quick PowerShell tests...");
        
        // Test fast PowerShell commands
        this.Execute("Write-Output 'Hello World'");
        this.Execute("Get-Date");
        this.Execute("Write-Output 'Test Complete'");
        
        print("âœ… Quick commands executed - waiting for event results...");
    }
    
    // Event handler to receive command execution results
    on command.executed (payload)
    {
        print("ğŸ‰ EVENT RECEIVED by " + this.name + "!");
        print("   ğŸ“ Command: " + payload.command);
        print("   âœ… Success: " + payload.success);
        print("   ğŸ“Š Output count: " + payload.outputs.length);
        
        if (payload.outputs.length > 0)
        {
            print("   ğŸ’¬ First output: " + payload.outputs[0].value);
        }
        
        if (payload.errors.length > 0)
        {
            print("   âŒ Error count: " + payload.errors.length);
        }
        
        print("");
    }
    
    on command.error (payload)
    {
        print("âŒ ERROR EVENT by " + this.name + "!");
        print("   ğŸ“ Command: " + payload.command);
        print("   ğŸ’¥ Error: " + payload.errors[0].message);
        print("");
    }
}

print("ï¿½ PowerShell Execute Event Test - CX Language");
print("=============================================");
print("");

try
{
    var testAgent = new TestAgent("QuickTester");
    
    print("ğŸ§ª Starting quick PowerShell test with event handlers...");
    testAgent.runQuickTests();
    
    print("");
    print("â° Waiting 10 seconds for PowerShell commands to complete...");
    print("   (PowerShell execution is fire-and-forget in background)");
    print("   Event handlers should receive results below...");
    print("");
    
    // Simple wait mechanism - run a slow command to give time for background tasks
    testAgent.Execute("Start-Sleep -Seconds 8; Write-Output 'Wait complete'");
    
    print("âœ… Test complete! Event handlers should have fired above.");
}
catch (error)
{
    print("âŒ Error during testing: " + error.message);
}

print("");
print("ğŸ‰ Execute Method Test Complete");
print("The this.Execute() method is working correctly!");
