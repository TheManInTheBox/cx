// Test AI service completion event handlers
// This verifies that services emit completion events and handlers catch them

conscious ServiceCompletionTester {
    realize() {
        print("ğŸ”§ SERVICE COMPLETION TEST STARTING");
        print("=======================================");
        
        // Test learn service with completion event
        learn { data: "Test learning data", category: "debug", expectCompletion: true };
        print("ğŸ“š Learn request with completion tracking sent");
        
        // Test infer service with completion event  
        infer { context: "Test context", type: "debug", expectCompletion: true };
        print("ğŸ” Infer request with completion tracking sent");
        
        await { reason: "Wait for service processing and completion events", minDurationMs: 5000, maxDurationMs: 8000 };

        print("ğŸ”§ SERVICE COMPLETION TEST COMPLETE");
        print("If you see CAUGHT completion events above, service-to-handler communication is working");
    }
}

// Global event handlers to catch service completion events
on learn.debug.complete (event) {
    print("ğŸ¯ CAUGHT: learn.debug.complete event from LearnService");
    print("ğŸ“Š Event data: " + event.data);
    print("âœ… LearnService â†’ Handler communication successful!");
}

on infer.debug.complete (event) {
    print("ğŸ¯ CAUGHT: infer.debug.complete event from InferService");
    print("ğŸ“Š Event context: " + event.context);
    print("âœ… InferService â†’ Handler communication successful!");
}

on inference.complete (event) {
    print("ğŸ¯ CAUGHT: inference.complete event (default handler)");
    print("ğŸ“Š Inference result: " + event.result);
}

// Create and run the test
var tester = new ServiceCompletionTester();
print("ğŸš€ Service completion test with event handler verification complete");
