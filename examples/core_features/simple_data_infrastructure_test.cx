// CX Language Simple Data Infrastructure Test
// Focused test for basic data flow validation using consciousness patterns

conscious SimpleDataTest
{
    realize(self: conscious)
    {
        learn self;
        
        print("ğŸ§ª Data Infrastructure Test Starting");
        print("====================================");
        
        // Test Data Ingestion
        print("ğŸ“¥ Phase 1: Testing Data Ingestion");
        learn {
            data: {
                source: "test-api",
                records: 50,
                consciousnessLevel: "consciousness",
                testType: "data-ingestion"
            },
            handlers: [ data.ingestion.complete ]
        };
        
        // Test Vector Storage
        print("ğŸŒ Phase 2: Testing Vector Storage");
        infer {
            context: "Store vectors with consciousness indexing",
            data: {
                vectorCount: 50,
                dimensions: 768,
                consciousnessIndexing: true,
                testType: "vector-storage"
            },
            handlers: [ vector.storage.complete ]
        };
        
        // Test Local Cache
        print("ğŸ’¾ Phase 3: Testing Local Cache");
        learn {
            data: {
                syncFromGlobal: true,
                preserveConsciousness: true,
                edgeOptimization: true,
                testType: "local-cache"
            },
            handlers: [ local.cache.complete ]
        };
        
        // Test Similarity Search
        print("ğŸ” Phase 4: Testing Similarity Search");
        infer {
            context: "Search cached vectors with consciousness alignment",
            data: {
                queryVector: "test-vector",
                topK: 5,
                consciousnessThreshold: 0.7,
                testType: "similarity-search"
            },
            handlers: [ similarity.search.complete ]
        };
        
        // Wait for all processing to complete
        await { reason: "Wait for all data infrastructure tests to complete", minDurationMs: 5000, maxDurationMs: 10000 };
        
        print("âœ… Data Infrastructure Test Complete");
        print("All phases should show CAUGHT messages above");
    }
}

// Global event handlers for test validation
on data.ingestion.complete (event) {
    print("ğŸ¯ CAUGHT: data.ingestion.complete");
    print("ğŸ“¥ Data ingestion test successful!");
    print("ğŸ” Event: " + event);
}

on vector.storage.complete (event) {
    print("ğŸ¯ CAUGHT: vector.storage.complete");
    print("ğŸŒ Vector storage test successful!");
    print("ğŸ” Event: " + event);
}

on local.cache.complete (event) {
    print("ğŸ¯ CAUGHT: local.cache.complete");
    print("ğŸ’¾ Local cache test successful!");
    print("ğŸ” Event: " + event);
}

on similarity.search.complete (event) {
    print("ğŸ¯ CAUGHT: similarity.search.complete");
    print("ğŸ” Similarity search test successful!");
    print("ğŸ” Event: " + event);
}

var dataTest = new SimpleDataTest({ });
print("ğŸ§  Data Infrastructure Test with consciousness patterns completed");
