// ğŸ¯ COMPLETE CX EVENT SYSTEM DEMONSTRATION
// This demo showcases the full power of CX Language's event-driven architecture

// ğŸŒ GLOBAL EVENT HANDLERS - Available throughout the program
on system.ready (payload) 
{
    print("ğŸŒŸ GLOBAL: System is ready - " + payload.message);
}

on user.any.input (payload) 
{
    print("ğŸŒ GLOBAL WILDCARD: Caught user input from any namespace - " + payload.source);
}

on command.executed (payload) 
{
    print("ğŸ”§ GLOBAL: Command executed - " + payload.command);
    print("   Success: " + payload.success + ", Exit Code: " + payload.exitCode);
    
    if (payload.success) 
    {
        print("   âœ… Output count: " + payload.outputs.length);
    } 
    else 
    {
        print("   âŒ Error count: " + payload.errors.length);
    }
}

on command.error (payload) 
{
    print("ğŸš« GLOBAL: Command failed - " + payload.command);
    print("   Error: " + payload.errorMessage);
}

// ğŸ¤– INTELLIGENT SYSTEM AGENT
class SystemAgent 
{
    name: string;
    department: string;
    
    constructor(agentName, dept) 
    {
        this.name = agentName;
        this.department = dept;
        print("ğŸ¤– " + agentName + " agent created in " + dept + " department");
    }
    
    // ğŸ¯ CLASS-LEVEL EVENT HANDLERS - Only for this agent instance
    on command.executed (payload) 
    {
        print("ğŸ¯ " + this.name + ": My command completed - " + payload.command);
        
        // Demonstrate AI learning from command results
        this.Learn({
            event: "command_executed",
            command: payload.command,
            success: payload.success,
            department: this.department
        });
        
        // Trigger thinking about the results
        if (payload.success) 
        {
            this.Think("Analyze the successful execution of: " + payload.command);
        }
    }
    
    on command.error (payload) 
    {
        print("âŒ " + this.name + ": My command failed - " + payload.command);
        print("   Error details: " + payload.errorMessage);
        
        // Learn from failures
        this.Learn({
            event: "command_error",
            command: payload.command,
            error: payload.errorMessage,
            department: this.department
        });
    }
    
    on user.any.request (payload) 
    {
        print("ğŸ‘¤ " + this.name + ": Received user request - " + payload.message);
        
        // AI-powered response to user requests
        this.Chat("User requested: " + payload.message + ". I'm a " + this.department + " agent.");
    }
    
    // ğŸ” Agent Methods
    function runDiagnostics() 
    {
        print("ğŸ” " + this.name + " starting comprehensive diagnostics...");
        
        // Execute multiple PowerShell commands
        this.Execute("Get-ComputerInfo | Select-Object WindowsProductName, TotalPhysicalMemory");
        this.Execute("Get-Process | Select-Object Name, WorkingSet | Sort-Object WorkingSet -Descending | Select-Object -First 3");
        this.Execute("Test-Connection -ComputerName google.com -Count 1 -Quiet");
        
        print("ğŸ’« " + this.name + " diagnostics dispatched - monitoring for results...");
    }
    
    function simulateError() 
    {
        print("ğŸ’¥ " + this.name + " simulating error for testing...");
        
        // This command will fail and trigger error events
        this.Execute("Get-NonExistentCommand -BadParameter");
    }
}

// ğŸŒŸ MONITORING AGENT WITH WILDCARDS
class MonitoringAgent 
{
    name: string;
    alertLevel: string;
    
    constructor(agentName, level) 
    {
        this.name = agentName;
        this.alertLevel = level;
        print("ğŸ‘ï¸ " + agentName + " monitoring agent initialized (Alert Level: " + level + ")");
    }
    
    // ğŸŒŸ WILDCARD EVENT HANDLERS - Catch events across namespaces
    on system.any.error (payload) 
    {
        print("âš ï¸ " + this.name + ": System error detected - " + payload.message);
        
        if (this.alertLevel == "high") 
        {
            emit any.any.critical, { 
                message: "High-priority system error: " + payload.message,
                monitor: this.name,
                timestamp: "2025-07-22T10:30:00Z"
            };
        }
    }
    
    on any.any.critical (payload) 
    {
        print("ğŸš¨ " + this.name + ": CRITICAL ALERT - " + payload.message);
        print("   Escalating to emergency protocols...");
    }
    
    function generateReport() 
    {
        print("ğŸ“‹ " + this.name + " generating monitoring report...");
        
        // AI-powered report generation
        this.Generate("Create a system monitoring report based on recent events and performance data");
    }
}

// ğŸš€ MAIN PROGRAM EXECUTION
print("ğŸ¯ COMPLETE CX EVENT SYSTEM DEMONSTRATION");
print("=========================================\n");

// Emit initial system ready event
emit system.ready, { 
    message: "Event system demonstration starting",
    version: "1.0.0",
    timestamp: "2025-07-22T10:30:00Z"
};

print("ğŸ¤– Creating intelligent agents...\n");

// Create multi-agent system
var sysAgent = new SystemAgent("Alpha-7", "Infrastructure");
var monitorAgent = new MonitoringAgent("WatchTower-1", "high");

print("\nğŸ“¡ Testing cross-agent communication...\n");

// Test user input events
emit user.chat.input, {
    message: "Please run a system diagnostic",
    source: "user_interface",
    priority: "normal"
};

emit user.voice.request, {
    message: "Check system security status",
    source: "voice_interface",
    confidence: 0.95
};

print("\nğŸ”¬ Running system diagnostics...\n");

// Run diagnostics that will trigger events
sysAgent.runDiagnostics();

print("\nğŸ“Š Monitoring agent generating report...\n");

// Generate monitoring report
monitorAgent.generateReport();

print("\nğŸ’¥ Testing error handling...\n");

// Simulate error for testing
sysAgent.simulateError();

// Simulate system error
emit system.network.error, {
    message: "Network connectivity issue detected",
    severity: "medium",
    component: "ethernet_adapter"
};

print("\nğŸ‰ EVENT SYSTEM FEATURES DEMONSTRATED:");
print("âœ… Global event handlers");
print("âœ… Class-scoped event handlers");  
print("âœ… Wildcard pattern matching (user.any.*, system.any.*, any.any.*)");
print("âœ… Multi-agent coordination");
print("âœ… Cross-namespace communication");
print("âœ… AI integration (Think, Learn, Chat, Generate)");
print("âœ… PowerShell command execution with events");
print("âœ… Error handling and recovery");
print("âœ… Real-time event processing");
print("âœ… Anonymous type payload handling");
print("âœ… Robust interpreter-based event processing");

print("\nğŸ”¬ Monitoring for background events...");
print("Press any key to exit and see final event processing...");
