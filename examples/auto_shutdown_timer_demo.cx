// Auto Shutdown Timer Demo - Demonstrates the new automatic system shutdown capabilities
// This shows how CX Language applications automatically terminate after a configurable delay

conscious AutoTimerAgent
{
    realize(self: conscious)
    {
        learn self;
        emit agent.ready { name: self.name };
    }
    
    on user.demo.start (event)
    {
        print("ğŸ¯ Auto Shutdown Timer Demo Starting");
        print("=====================================");
        print("This demo shows the automatic shutdown timer in action:");
        print("â€¢ System automatically shuts down after 30 seconds (default)");
        print("â€¢ Timer can be cancelled, extended, or monitored");
        print("â€¢ Provides graceful shutdown for all applications");
        print("");
        
        // Demonstrate timer control
        emit timer.control.demo;
    }
    
    on timer.control.demo (event)
    {
        print("ğŸ•’ Demonstrating timer control capabilities...");
        
        // Example: Extend the timer if we need more time
        print("â° Extending auto shutdown timer by 10 seconds");
        emit timer.shutdown.extend { additionalMs: 10000 };
        
        // Show how to cancel if needed (commented out for demo)
        // print("âŒ To cancel timer: emit timer.shutdown.cancel { reason: 'user_interaction' }");
        
        print("âœ¨ Timer extended! System will now shutdown later");
        print("ğŸ“Š Watch the timer events below...");
    }
    
    // Auto timer event handlers
    on timer.shutdown.started (event)
    {
        print("ğŸš€ AUTO TIMER: Timer started");
        print("ğŸ“… Start time: " + event.startTime);
        print("â±ï¸ Delay: " + event.delaySeconds + " seconds");
        print("ğŸ•’ Estimated shutdown: " + event.estimatedShutdownTime);
        print("ğŸ¯ Reason: " + event.reason);
    }
    
    on timer.shutdown.extended (event)
    {
        print("â° AUTO TIMER: Timer extended");
        print("â• Additional time: " + event.additionalSeconds + " seconds");
        print("ğŸ•’ New estimated shutdown: " + event.newEstimatedShutdownTime);
        print("âœ… Timer extension applied successfully");
    }
    
    on timer.shutdown.elapsed (event)
    {
        print("â±ï¸ AUTO TIMER: Timer elapsed");
        print("ğŸ›‘ Automatic shutdown initiated");
        print("ğŸ“… Elapsed at: " + event.elapsedAt);
        print("ğŸ¯ Original delay: " + event.originalDelayMs + "ms");
        print("ğŸ”„ System shutdown in progress...");
    }
    
    on timer.shutdown.cancelled (event)
    {
        print("âŒ AUTO TIMER: Timer cancelled");
        print("ğŸ¯ Cancellation reason: " + event.reason);
        print("ğŸ“… Cancelled at: " + event.cancelledAt);
        print("â™¾ï¸ Application will run indefinitely until manual shutdown");
    }
}

// Global system handlers
on system.start (event)
{
    print("ğŸ”¥ CX Language Auto Shutdown Timer Demo");
    print("=======================================");
    print("ğŸ§  This demo showcases the new automatic shutdown timer feature");
    print("â° Default timer: 30 seconds + 10 second extension = 40 seconds total");
    print("ğŸ¯ Timer ensures graceful shutdown without manual intervention");
    print("");
    
    var timerAgent = new AutoTimerAgent({ name: "TimerBot" });
    emit user.demo.start;
}

on system.shutdown (event)
{
    print("");
    print("ğŸ”´ SYSTEM SHUTDOWN EVENT RECEIVED");
    print("==================================");
    print("ğŸ¯ Shutdown reason: " + event.reason);
    print("ğŸ“Š Shutdown source: " + event.source);
    print("ğŸ“… Shutdown time: " + event.shutdownTime);
    print("âœ… Auto shutdown timer working perfectly!");
    print("ğŸŒŸ Thank you for testing the CX Language auto timer feature");
    print("");
}
